<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
	Based on HTML template by TEMPLATED, http://templated.co
	Released for free under the Creative Commons Attribution License
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Chapman & Feit: R for Marketing Research and Analytics</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<link href="default.css" rel="stylesheet" type="text/css" />
</head>

<body>
    
<div id="outer">
    
	<div id="header">
		<h1><a href="index.html">R for Marketing Research and Analytics, 2nd Ed.</a></h1>
		<h2></h2>
	</div>
    
	<div id="menu">
		<ul>
			<li><a href="code.html" accesskey="3" title="">Code</a></li>
			<li><a href="data.html" accesskey="2" title="data">Data</a></li>
            <li><a href="exercises/index.html" accesskey="8" title="">Exercises</a></li>
            <li><a href="Instructor/slides-index.html" accesskey="9" title="">Classroom</a></li>
			<li><a href="about.html" accesskey="4" title="">About</a></li>
            <li><a href="faq.html" accesskey="7" title="">FAQ</a></li>
            <li><a href="errata.html" accesskey="6" title="">Errata</a></li>
		</ul>
	</div>
    
	<div id="content">
		<div id="primaryContentContainer">
			<div id="primaryContent">
                <h2>Errata for 2nd edition</h2>
                 <p><b>General note</b>. R packages often change their computation algorithms, function names, and requirements. <strong>If your code doesn't work or the output doesn't match what is shown in the book</strong>, see <b>Section 1.6.4</b> in the book for notes and ideas.</p>
                
                <h3><i>For 1st edition errata, see <a href="errata-1ed.html">Errata for 1st edition only.</a></i></h3>
                
                <h3>Specific errata and package update notes</h3>
                
                
                <table>
                    <tr>
                        <th>Page</th>
                        <th>Change</th>
                    </tr>
               
                    <tr class="rowB">
                       <td>(throughout, including 36, 49, 77, 80, 112, 133, 158, 188, 194, 220, 224, 230, 241, 248, 262, 263, 271, 282, 295, 296, 302, 338, 356, 361)</td>
                        <td>R 4.0 changed its handling of nominal/factor variables when reading data frames. To match previous results, you may add <b><code>stringsAsFactors=TRUE</code></b> to calls of <code>read.csv()</code>. In older versions of R (prior to R 4.0 in May 2020), text strings were converted by default to categorical factor variables. Starting in R 4.0 they are read as raw text and not converted to factors.<br><br>
                        
                        To obtain results as shown in the book, <code>stringsAsFactors=TRUE</code> must be added to  occurrences of <code>read.csv()</code> unless it is already specified otherwise (such as being set to FALSE). <br><br>For example, on page 49, you may obtain the results shown in the book by using this command:<br><br>

<pre>
store.df <- read.csv("http://goo.gl/QPDdMl", stringsAsFactors=TRUE)  # added stringsAsFactors=TRUE
</pre>
                        </td>
                     </tr>
                    
                     <tr class="rowA">
                       <td>371, 379</td>
                         <td><b>Errors with the <code>mlogit.data</code> function.</b> The package <code>mlogit</code> version 1.10 changed its data structure, such that code that calls <code>mlogit.data()</code> gives an error about the <code>dfidx</code> package (a new data indexing package used by <code>mlogit</code>). This is fixed in the latest version of our <a href="code.html"> code files</a>.<br><br>
                            More specifically, the following line from the book produces an error:<br><br>
                            <pre>
cbc.mlogit <- mlogit.data(data=cbc.df, choice="choice", shape="long", 
+                         varying=3:6, alt.levels=paste("pos", 1:3), 
+                         id.var="resp.id")
</pre>
<br>The error it produces is this:<br><br>
<pre>
Error in guess(varying) : 
  failed to guess time-varying variables from their names
</pre>
<br>This is due to unnecessary specification of varying columns (which is only needed for wide data). The solution is to remove that and to add unique -- across all respondents -- indexes for the choice sets, as follows. Use these lines of code instead of the one above:<br><br>
<pre>
library(dfidx)      # install if needed
# add a column with unique question numbers, as needed in mlogit 1.1+
cbc.df$chid <- rep(1:(nrow(cbc.df)/3), each=3)
# shape the data for mlogit
cbc.mlogit <- dfidx(cbc.df, choice="choice", 
+                   idx=list(c("chid", "resp.id"), "alt" ))
</pre>
                            
                            <br><br>Alternatively, you may use any of the following approaches for CBC data:<br><br>
                            <ul>
                                <li>Simply download and use the new code files as noted above.</li>
                                <li>Install an older version of <code>mlogit</code> (such as <code>mlogit 1.0-1</code>). Installing an older package can be complex and may require developer tools (such as a gcc compiler). We are not able to provide assistance with that process, but <a href="https://support.rstudio.com/hc/en-us/articles/219949047-Installing-older-versions-of-packages">see here</a> for more details. Assuming you have the required tooling, the following will install <code>mlogit 1.0-1</code>, which works with the code in our book:<br><br>
                                
                                <pre>
install.packages(c("devtools", "lmtest", "statmod"))
library(devtools)
install_version("mlogit", version="1.0-1", repos="http://cran.us.r-project.org")
                                </pre>
                                </li>
                                <li><b>Or</b>, skip the sections about <code>mlogit</code> estimation (e.g., Sections 13.3.2, 13.4.1), and use hierarchical Bayes estimation instead (Section 13.5).</li>
                            </ul>

                        </td>
                     </tr>

                     
                    <tr class="rowB">
                       <td>(throughout)</td>
                            <td><p><b>Random data generation</b>: Just after publication of the book in April 2019, R versions 3.6.0 and later changed the way random numbers are generated. In many chapters we simulate data and perform other functions that use random numbers. Those results will change slightly from what the book shows. Options include:</p>
                            <li><b>To match the book, <i>when using downloaded data</i></b>: no action is needed. You will notice few differences, except for minor details such as results from the <code>some()</code> function, and slightly different results in some Bayesian statistics (which use randomization).</li><br>
                            <li><b>To match the book exactly</b> (especially <i>when simulating the data</i> as we recommend): give the following command after starting R and <i>before</i> running code from the book:<br><br>
                                <pre>
                                RNGversion("3.5.0")
                                </pre>
                                </li>
                            <li><b>To see how things change</b>: just go ahead and use R's new default random number generator. Compare results to the book. They will be slightly different in the exact data points, yet quite similar for the overall statistical results.</li><br>
                            <li>If you're interested to read more about the reason for the change, see <a href="https://stat.ethz.ch/pipermail/r-devel/2018-September/076817.html">Bias in R's random integers?</a></li>
                        </td>
                     </tr>

                    <tr class="rowA">
                       <td>109</td>
                        <td>Question 11 in the Exercises will not compute in the latest version of <code>psych::polychoric</code>. Answer the following question instead: what does the error message tell you?
                        </td>
                     </tr>

                    
                </table>
                
                <h3>Bug reports</h3>
				<table>
					<tr>
						<th>What</th>
						<th>How</th>
					</tr>
					<tr class="rowA">
                        <td><b>Report a suspected bug</b><br>Include the chapter and page, with a <i>reproducible example</i>.</td>
						<td><b>email</b>: cnchapman+rbug@gmail.com<br>or <b>better</b>, report to the <a href="http://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/r-marketing-bugs">bugs mailing list</a>.</td>
					</tr>
					<tr class="rowB">
						<td>Join the bugs mailing list</td>
						<td><a href="http://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/r-marketing-bugs">Sign up here</a></td>
					</tr>
					<tr class="rowA">
						<td>Check mailing list archives</td>
						<td><a href="http://lists.r-forge.r-project.org/pipermail/r-marketing-bugs/">Bug archives</a></td>
					</tr>

				</table>


            </div>
		</div>
        
        
		<div class="clear"></div>
	</div>
    
	<div id="footer">
		<p>Copyright &copy; 2015, Chris Chapman and Elea McDonnell Feit. Design based on <a href="http://templated.co" rel="nofollow">Rational template</a>, used under Creative Commons Attribution License.</p>
	</div>
    
</div>
    
</body>
</html>
