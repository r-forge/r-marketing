{
    "contents" : "\nR for Marketing Research and Analytics\n========================================================\nAuthor: Chris Chapman and Elea McDonnell Feit\nDate: January 2016\ncss: ../chapman-feit-slides.css\nwidth: 1024\nheight: 768\n\n**Chapter 4: Relationships between Variables (Bivariate Statistics)**  \n\nWebsite for all data files:  \n[http://r-marketing.r-forge.r-project.org/data.html](http://r-marketing.r-forge.r-project.org/data.html)\n\n\nLoad CRM data\n========\nAs always, see the book for details about data simulation. Meanwhile, we'll load it.\nThis is example data with data on customers' visits, transactions, and spending for online \nand retail purchases:\n```{r}\ncust.df <- read.csv(\"http://goo.gl/PmPkaG\")\nstr(cust.df)\n```\n\n\n\nConverting data to factors\n========\nText data is automatically converted to factors when reading CSVs. However, sometimes data that appears to be numeric is really not.\n\nThe factor() function will convert data to nominal factors:\n\n```{r}\nstr(cust.df$cust.id)\ncust.df$cust.id <- factor(cust.df$cust.id)\n\nstr(cust.df$cust.id)\n```\n\nOption: ordered=TRUE (or ordered() function) creates ordinal factors.\n\n\nBasic scatterplot\n========\nLet's look at scatterplots. How does age relate to credit score?\n```{r}\nplot(x=cust.df$age, y=cust.df$credit.score)\n```\n\n\nA better plot\n========\nAdd color, labels, and adjust the axis limits:\n```{r}\nplot(cust.df$age, cust.df$credit.score, \n     col=\"blue\",\n     xlim=c(15, 55), ylim=c(500, 900), \n     main=\"Active Customers as of June 2014\",\n     xlab=\"Customer Age (years)\", ylab=\"Credit Score \")\n\n```\n\nAdd a regression line\n========\nabline() adds a regression line from a linear model (we'll\ndiscuss regression in depth later)\n\n```{r}\nplot(cust.df$age, cust.df$credit.score, \n     col=\"blue\", xlim=c(15, 55), ylim=c(500, 900), \n     xlab=\"Customer Age (years)\", ylab=\"Credit Score \")\n\nabline(lm(cust.df$credit.score ~ cust.df$age))\n```\n\n\nZero-inflated and skewed data\n========\n\nQuestion: how do online sales relate to in-store sales? Does online decrease or increase online sales?\n\nBefore starting on this, note that customer data often has two issues:\n* __Skew__: many small transactions, few large ones\n* __Zero inflation__: many zero values (because many customers spend $0 in any period)\n\nThere are various ways to handle these issues, but an easy approach is to use\nlogarithmic plots. Instead of plotting on raw scales, plot on logarithmic scale.\n\nLet's look at this in steps.\n\n\nScatterplot with skew\n========\nHow does in-store spending relate to online spending? \nIt's hard to tell because both are skewed! The apparent negative slope is \nvery misleading.\n```{r}\nplot(cust.df$store.spend, cust.df$online.spend, \n     xlab=\"Prior 12 months in-store sales ($)\", \n     ylab=\"Prior 12 months online sales ($)\")\n```\n\nLooking at the skew\n========\nA histogram reveals the skew, e.g., for in-store spending:\n\n```{r}\nhist(cust.df$store.spend, \n     breaks=(0:ceiling(max(cust.df$store.spend)/10))*10,\n     xlab=\"Prior 12 months online sales ($)\" )\n```\n\nUsing logarithmic axes\n========\nUse the log= argument to set one or both axes to logarithmic. **Caution**: \nlog(x $\\le$ 0) is not defined, so make sure values are positive. Add a constant\nsuch as +1 if needed. Now we see little or no relationship:\n```{r}\nplot(cust.df$store.spend + 1, cust.df$online.spend + 1,\n     log=\"xy\")\n```\n\n\n\nMulti-panel plots\n========\nHow does distance relate to in-store and online spending? Use par(mfrow=c(ROWS, COLUMNS)) to put multiple plots together:\n```{r}\npar(mfrow=c(2, 2))\nwith(cust.df, plot(distance.to.store, store.spend))\nwith(cust.df, plot(distance.to.store, online.spend))\nwith(cust.df, plot(distance.to.store, store.spend+1, log=\"xy\"))\nwith(cust.df, plot(distance.to.store, online.spend+1, log=\"xy\"))\n```\n\n\nScatterplot matrix: Quick 2-way Visualization\n========\n```{r}\npairs(formula = ~ age + credit.score + distance.to.store + \n                  online.spend + store.trans + store.spend,\n      data=cust.df)\n```\n\n\npairs(cust.df[ , c(2:10)])\n\nFancy alternative: scatterplotMatrix in \"car\"\n========\n```{r}\nlibrary(car)       # install if needed\nscatterplotMatrix(formula = ~ age + credit.score + \n                    distance.to.store + online.spend + \n                    store.trans + store.spend,\n                  data=cust.df, diagonal=\"histogram\")\n```\n\n\nCorrelation\n========\nA basic inferential test of Pearson's $r$ can be done with cor.test():\n```{r}\ncor.test(cust.df$age, cust.df$credit.score)\n```\nAge is associated with credit score here, $r = 0.25, p \\lt .05$.\n\n\nCorrelation matrix\n========\nThe cor() function computes $r$ between all pairs of variables:\n```{r}\ncor(cust.df[, c(2, 3, 5:12)])  # only numeric cols\n```\n\n\nRedoing that with complete cases\n========\nAdd **use=\"complete.obs\"** argument:\n```{r}\ncor(cust.df[, c(2, 3, 5:12)], use=\"complete.obs\")\n```\n\n\nVisualize correlation matrix\n========\nUse the \"corrplot\" package. See book (and help) for more options.\n```{r}\nlibrary(corrplot)    # install if needed\ncorrplot(corr=cor(cust.df[ , c(2, 3, 5:12)], \n                  use=\"complete.obs\"), \n         method =\"ellipse\")\n```\n\n\nData Transformation\n========\nR makes it easy to explore common transformations (log, 1/x, sqrt, etc.)\n\n```{r}\ncor(cust.df$distance.to.store, cust.df$store.spend)\ncor(1/cust.df$distance.to.store, cust.df$store.spend)\ncor(1/sqrt(cust.df$distance.to.store), cust.df$store.spend)\n```\nWe see that closeness to store ($1/distance$) is strongly relation to spend.\nHaving a good transformation gives a better estimate of strength.\n\nSee book for more on common transformations and how to find an optimal transform.\n\n\n\nPolychoric correlation\n========\nWith ordinal variables such as satisfaction ratings, consider polychoric\ncorrelation instead of Pearson's r. We need it because the ratings are not \nfine grained, and plot on top of one another:\n```{r}\nplot(cust.df$sat.service, cust.df$sat.selection, \n     xlab=\"Sat, Service\", ylab=\"Sat, Selection\")\n```\n\n\nPolychoric correlation test\n========\nFirst identify respondents with data:\n```{r}\nresp <- !is.na(cust.df$sat.service)\n```\n\nNow compare Pearson correlation to polychoric:\n```{r}\ncor(cust.df$sat.service[resp], cust.df$sat.selection[resp]) \n\nlibrary(psych)   # install if needed\npolychoric(cbind(cust.df$sat.service[resp], \n                 cust.df$sat.selection[resp]))\n```\n\n\nThat's all for Chapter 4\n=========\ntype: section\n\n# Thank you! Time for Q&A.\n\n\nNotes\n========\n<small>\nThis presentation is based on Chapter 4 of Chapman and Feit, *R for Marketing Research and Analytics* &copy; 2015 Springer.    \n   \nAll code in the presentation is licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\\ Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.  \n</small>\n\n",
    "created" : 1449601591591.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "826193507",
    "id" : "8619948D",
    "lastKnownWriteTime" : 1450661819,
    "path" : "~/Documents/Chris Documents/papers/repos/RIntroBook/Instructor/Chapter4/Chapter4-ChapmanFeit.Rpres",
    "project_path" : "Chapter4/Chapter4-ChapmanFeit.Rpres",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_presentation"
}